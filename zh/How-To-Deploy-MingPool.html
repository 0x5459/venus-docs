<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Venus集群组件介绍 | 启明星</title>
    <meta name="generator" content="VuePress 1.8.0">
    <link rel="icon" href="/assets/venus-logo.png">
    <meta name="description" content="Venus是完全兼容Filecoin分布式存储网络的一个go版本代码实现">
    
    <link rel="preload" href="/assets/css/0.styles.c83c03d3.css" as="style"><link rel="preload" href="/assets/js/app.85d61b07.js" as="script"><link rel="preload" href="/assets/js/2.8f9c6f4c.js" as="script"><link rel="preload" href="/assets/js/15.37f290d9.js" as="script"><link rel="prefetch" href="/assets/js/10.6e40e909.js"><link rel="prefetch" href="/assets/js/11.e54157ee.js"><link rel="prefetch" href="/assets/js/12.0a701583.js"><link rel="prefetch" href="/assets/js/13.9056e2f8.js"><link rel="prefetch" href="/assets/js/14.f40e4cf6.js"><link rel="prefetch" href="/assets/js/16.fbf39b45.js"><link rel="prefetch" href="/assets/js/17.b4b9901c.js"><link rel="prefetch" href="/assets/js/18.9308105a.js"><link rel="prefetch" href="/assets/js/19.f224d3c7.js"><link rel="prefetch" href="/assets/js/20.903bfd0f.js"><link rel="prefetch" href="/assets/js/21.ff004bb1.js"><link rel="prefetch" href="/assets/js/22.fb6878df.js"><link rel="prefetch" href="/assets/js/23.d9aafeb7.js"><link rel="prefetch" href="/assets/js/24.4c4dea4f.js"><link rel="prefetch" href="/assets/js/25.3e5a8ba1.js"><link rel="prefetch" href="/assets/js/26.54b57e19.js"><link rel="prefetch" href="/assets/js/27.04e151b8.js"><link rel="prefetch" href="/assets/js/28.43c75954.js"><link rel="prefetch" href="/assets/js/29.ca8a087b.js"><link rel="prefetch" href="/assets/js/3.13530216.js"><link rel="prefetch" href="/assets/js/30.bf0a86fc.js"><link rel="prefetch" href="/assets/js/31.2aa6eb7b.js"><link rel="prefetch" href="/assets/js/32.5ffe3521.js"><link rel="prefetch" href="/assets/js/33.c816ce46.js"><link rel="prefetch" href="/assets/js/34.c5e31ec2.js"><link rel="prefetch" href="/assets/js/35.88af517d.js"><link rel="prefetch" href="/assets/js/36.613c4ea5.js"><link rel="prefetch" href="/assets/js/37.8a23c099.js"><link rel="prefetch" href="/assets/js/38.239858e5.js"><link rel="prefetch" href="/assets/js/39.b1b31985.js"><link rel="prefetch" href="/assets/js/4.49ff5cb8.js"><link rel="prefetch" href="/assets/js/40.ee2bfb24.js"><link rel="prefetch" href="/assets/js/41.ad3b94d5.js"><link rel="prefetch" href="/assets/js/42.863fa233.js"><link rel="prefetch" href="/assets/js/43.11dfc892.js"><link rel="prefetch" href="/assets/js/44.97959562.js"><link rel="prefetch" href="/assets/js/45.45e17dcb.js"><link rel="prefetch" href="/assets/js/46.a95338e1.js"><link rel="prefetch" href="/assets/js/47.32c0a1d1.js"><link rel="prefetch" href="/assets/js/48.f3f9485c.js"><link rel="prefetch" href="/assets/js/49.ebdbd834.js"><link rel="prefetch" href="/assets/js/5.ba67176f.js"><link rel="prefetch" href="/assets/js/50.116da55e.js"><link rel="prefetch" href="/assets/js/51.631cf8e2.js"><link rel="prefetch" href="/assets/js/52.46a9a407.js"><link rel="prefetch" href="/assets/js/53.3b86188c.js"><link rel="prefetch" href="/assets/js/54.28f12483.js"><link rel="prefetch" href="/assets/js/55.65ca9abf.js"><link rel="prefetch" href="/assets/js/56.2536577d.js"><link rel="prefetch" href="/assets/js/57.c670fba6.js"><link rel="prefetch" href="/assets/js/58.df03d0b1.js"><link rel="prefetch" href="/assets/js/59.8c5578c3.js"><link rel="prefetch" href="/assets/js/6.7f17614f.js"><link rel="prefetch" href="/assets/js/60.3069d101.js"><link rel="prefetch" href="/assets/js/61.a2effb95.js"><link rel="prefetch" href="/assets/js/62.8375bdbe.js"><link rel="prefetch" href="/assets/js/63.3764f4e3.js"><link rel="prefetch" href="/assets/js/64.055cc869.js"><link rel="prefetch" href="/assets/js/65.00b8fafe.js"><link rel="prefetch" href="/assets/js/66.d349e1ec.js"><link rel="prefetch" href="/assets/js/67.71c1a406.js"><link rel="prefetch" href="/assets/js/68.43921b93.js"><link rel="prefetch" href="/assets/js/69.c7b608f4.js"><link rel="prefetch" href="/assets/js/7.9d94c0e5.js"><link rel="prefetch" href="/assets/js/70.34c07c17.js"><link rel="prefetch" href="/assets/js/71.9ee41e80.js"><link rel="prefetch" href="/assets/js/8.8a50ff90.js"><link rel="prefetch" href="/assets/js/9.a24746e1.js">
    <link rel="stylesheet" href="/assets/css/0.styles.c83c03d3.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/zh/" class="home-link router-link-active"><img src="/assets/venus-logo-title.svg" alt="启明星" class="logo"> <span class="site-name can-hide">启明星</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Select language" class="dropdown-title"><span class="title">选择语言</span> <span class="arrow down"></span></button> <button type="button" aria-label="Select language" class="mobile-dropdown-title"><span class="title">选择语言</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/" class="nav-link">
  English
</a></li><li class="dropdown-item"><!----> <a href="/zh/How-To-Deploy-MingPool.html" aria-current="page" class="nav-link router-link-exact-active router-link-active">
  简体中文
</a></li></ul></div></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Select language" class="dropdown-title"><span class="title">选择语言</span> <span class="arrow down"></span></button> <button type="button" aria-label="Select language" class="mobile-dropdown-title"><span class="title">选择语言</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/" class="nav-link">
  English
</a></li><li class="dropdown-item"><!----> <a href="/zh/How-To-Deploy-MingPool.html" aria-current="page" class="nav-link router-link-exact-active router-link-active">
  简体中文
</a></li></ul></div></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>快速上手</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/zh/Overview.html" class="sidebar-link">概述</a></li><li><a href="/zh/How-To-Deploy-MingPool.html" aria-current="page" class="active sidebar-link">如何部署矿池</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/zh/How-To-Deploy-MingPool.html#_1-venus-auth-install" class="sidebar-link">1. Venus-auth Install</a></li><li class="sidebar-sub-header"><a href="/zh/How-To-Deploy-MingPool.html#_2-venus-gateway-install" class="sidebar-link">2. Venus-gateway Install</a></li><li class="sidebar-sub-header"><a href="/zh/How-To-Deploy-MingPool.html#_3-venus-install" class="sidebar-link">3. Venus install</a></li><li class="sidebar-sub-header"><a href="/zh/How-To-Deploy-MingPool.html#_4-venus-messager-install" class="sidebar-link">4. Venus-messager install</a></li><li class="sidebar-sub-header"><a href="/zh/How-To-Deploy-MingPool.html#_5-venus-miner-install" class="sidebar-link">5. Venus-miner install</a></li><li class="sidebar-sub-header"><a href="/zh/How-To-Deploy-MingPool.html#准备工作" class="sidebar-link">准备工作</a></li><li class="sidebar-sub-header"><a href="/zh/How-To-Deploy-MingPool.html#_1-venus-wallet-install" class="sidebar-link">1. Venus-wallet install</a></li><li class="sidebar-sub-header"><a href="/zh/How-To-Deploy-MingPool.html#_2-venus-sealer-install" class="sidebar-link">2. Venus-sealer install</a></li><li class="sidebar-sub-header"><a href="/zh/How-To-Deploy-MingPool.html#_7-问题相关" class="sidebar-link">7. 问题相关</a></li></ul></li><li><a href="/zh/Venus-replace-lotus.html" class="sidebar-link">从Lotus迁移到Venus</a></li><li><a href="/zh/chain.html" class="sidebar-link">链维护</a></li><li><a href="/zh/How-To-Connect-Network.html" class="sidebar-link">加入不同网络</a></li><li><a href="/zh/Troubleshooting-&amp;-FAQ.html" class="sidebar-link">故障排除</a></li><li><a href="/zh/How-To-Contribute-Docs.html" class="sidebar-link">贡献文档</a></li></ul></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>模块</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>进阶</span> <span class="arrow right"></span></p> <!----></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="venus集群组件介绍"><a href="#venus集群组件介绍" class="header-anchor">#</a> Venus集群组件介绍</h1> <p>Venus是Filecoin分布式矿池的实现方案之一，系统集群组件包括：Venus，Venus-auth，Venus-miner，Venus-wallet，Venus-messager，Venus-sealer。从概念上理解其中Venus、Venus-auth、Venus-miner、Venus-wallet、Venus-messager具备可共用性（即程序可被多个矿工身份使用，在保证效率的情况下使硬件，软件资源得到充分利用），而Venus-sealer、Venus-worker、Venus-wallet主要用于积累算力。Venus-wallet属于可选组件，基于部署情况的安全性考量，Venus-wallet可以共享使用，也可以本地部署。本篇文档为nerpda测试网络下的集群部署。</p> <p><img src="/assets/img/venus-cluster.2e72d412.png" alt="venus-cluster"></p> <h1 id="venus集群部署-基于nerpa测试网"><a href="#venus集群部署-基于nerpa测试网" class="header-anchor">#</a> Venus集群部署（基于nerpa测试网）</h1> <table><thead><tr><th>程序</th> <th>服务器</th> <th>类型</th> <th>作用</th></tr></thead> <tbody><tr><td>Venus-auth</td> <td>&lt;IP1&gt;</td> <td>共享</td> <td>Venus-auth 用于统一授权，当矿工组件访问共享组件的时候需要使用此服务注册生成的token</td></tr> <tr><td>Venus-gateway</td> <td>&lt;IP2&gt;</td> <td>共享</td> <td>桥接部分接口调用</td></tr> <tr><td>Venus</td> <td>&lt;IP3&gt;</td> <td>共享</td> <td>Filecoin节点数据同步</td></tr> <tr><td>Venus-messager</td> <td>&lt;IP4&gt;</td> <td>共享</td> <td>管理集群中的消息，保证消息上链，控制消息流量，重试等。可对接多个钱包，针对这些钱包做消息管理</td></tr> <tr><td>Venus-miner</td> <td>&lt;IP5&gt;</td> <td>共享</td> <td>打包出块消息，可配置多个矿工，会自行计算矿工出块情况，并通过远程访问Venus-sealer获取数据证明</td></tr> <tr><td>Venus-wallet</td> <td>&lt;IP6&gt;</td> <td>共享</td> <td>钱包管理，数据签名</td></tr> <tr><td>Venus-sealer</td> <td>&lt;IP7&gt;</td> <td>非共享</td> <td>数据封装</td></tr></tbody></table> <p>Tips:</p> <ul><li>以下所有<code>&lt;&gt;</code>都是需替换参数，根据自己的实际情况替换</li> <li>具体版本请自行使用git checkout选择</li> <li>环境依赖：
<ul><li>golang ^1.15
<ul><li>go env -w GOPROXY=https://goproxy.io,direct</li> <li>go env -w GO111MODULE=on</li></ul></li> <li>git</li></ul></li></ul> <h1 id="云上组件搭建"><a href="#云上组件搭建" class="header-anchor">#</a> 云上组件搭建</h1> <h2 id="_1-venus-auth-install"><a href="#_1-venus-auth-install" class="header-anchor">#</a> 1. Venus-auth Install</h2> <h3 id="编译并启动"><a href="#编译并启动" class="header-anchor">#</a> 编译并启动</h3> <div class="language-shell script extra-class"><pre class="language-shell"><code>$ <span class="token function">git</span> clone https://github.com/filecoin-project/venus-auth.git

$ <span class="token builtin class-name">cd</span> venus-auth

$ <span class="token function">make</span> 

$ <span class="token function">nohup</span> ./venus-auth <span class="token operator">&gt;</span> auth.log <span class="token operator"><span class="token file-descriptor important">2</span>&gt;</span><span class="token file-descriptor important">&amp;1</span> <span class="token operator">&amp;</span>

</code></pre></div><ul><li>Venus-auth服务默认配置文件目录为 ~/.venus-auth/config.toml</li> <li>存储方案默认为badger内嵌kv数据库，也支持MYSQL存储，需要自行修改配置文件后启动。</li> <li>log存储默为控制台打印，同时支持influxDB存储</li></ul> <h4 id="mysql存储启动-可选"><a href="#mysql存储启动-可选" class="header-anchor">#</a> MYSQL存储启动（可选）</h4> <p>Tips: MYSQL支持5.7以上官方版本（如云平台MYSQL默认设置各有不同，请自己结合云平台修改配置，否则可能会出现 “ Specified key was too long; max key length is 767 bytes ”）</p> <h5 id="修改venus-auth-config中的db设置"><a href="#修改venus-auth-config中的db设置" class="header-anchor">#</a> 修改Venus-auth config中的db设置</h5> <div class="language-shell script extra-class"><pre class="language-shell"><code>$ <span class="token function">vim</span> ~/.venus-auth/config.toml

<span class="token comment"># 数据源配置项</span>
<span class="token punctuation">[</span>db<span class="token punctuation">]</span>
<span class="token comment"># support: badger (default), mysql </span>
<span class="token comment"># the mysql DDL is in the script package </span>
<span class="token builtin class-name">type</span> <span class="token operator">=</span> <span class="token string">&quot;mysql&quot;</span> 
<span class="token comment"># The following parameters apply to MySQL</span>
DSN <span class="token operator">=</span> <span class="token string">&quot;root:111111@(127.0.0.1:3306)/venus_auth?parseTime=true&amp;loc=Local&amp;charset=utf8mb4&amp;collation=utf8mb4_unicode_ci&amp;readTimeout=10s&amp;writeTimeout=10s&quot;</span>
<span class="token comment"># conns 1500 concurrent</span>
maxOpenConns <span class="token operator">=</span> <span class="token number">64</span>
maxIdleConns <span class="token operator">=</span> <span class="token number">128</span>
maxLifeTime <span class="token operator">=</span> <span class="token string">&quot;120s&quot;</span>
maxIdleTime <span class="token operator">=</span> <span class="token string">&quot;30s&quot;</span>

</code></pre></div><ul><li>启动</li></ul> <div class="language-shell script extra-class"><pre class="language-shell"><code>$ <span class="token function">nohup</span> ./venus-auth <span class="token operator">&gt;</span> auth.log <span class="token operator"><span class="token file-descriptor important">2</span>&gt;</span><span class="token file-descriptor important">&amp;1</span> <span class="token operator">&amp;</span>
</code></pre></div><h3 id="注册生成云上组件互相访问需要的token"><a href="#注册生成云上组件互相访问需要的token" class="header-anchor">#</a> 注册生成云上组件互相访问需要的token</h3> <div class="language-shell script extra-class"><pre class="language-shell"><code>$ ./venus-auth genToken --perm admin admin
<span class="token operator">&lt;</span>auth miner<span class="token operator">&gt;</span>
</code></pre></div><ul><li><code>&lt;auth token ?&gt;</code> 格式统一为 JWT token</li> <li>这些token之后会被各个程序使用，用以对集群接入组件做验证</li> <li><code>--perm</code>为RPC2.0接口访问权限限制</li> <li>miner，messager，sealer，推荐标记为程序名，若存在多个相同程序要加入集群，可以使用“程序名+标记符”。</li></ul> <h2 id="_2-venus-gateway-install"><a href="#_2-venus-gateway-install" class="header-anchor">#</a> 2. Venus-gateway Install</h2> <div class="language-shell script extra-class"><pre class="language-shell"><code>$ <span class="token function">git</span> clone https://github.com/ipfs-force-community/venus-gateway.git
$ <span class="token builtin class-name">cd</span> venus-gateway
$ <span class="token function">make</span>

$ <span class="token function">nohup</span> ./venus-gateway --listen /ip4/0.0.0.0/tcp/45132 run --auth-url  http://<span class="token operator">&lt;</span>auth ip<span class="token operator">&gt;</span>:8989 <span class="token operator">&gt;</span> gateway.log <span class="token operator"><span class="token file-descriptor important">2</span>&gt;</span><span class="token file-descriptor important">&amp;1</span> <span class="token operator">&amp;</span>
</code></pre></div><h2 id="_3-venus-install"><a href="#_3-venus-install" class="header-anchor">#</a> 3. Venus install</h2> <h3 id="安装编译环境"><a href="#安装编译环境" class="header-anchor">#</a> 安装编译环境</h3> <div class="language-shell script extra-class"><pre class="language-shell"><code><span class="token function">sudo</span> yum <span class="token function">install</span> -y https://dl.fedoraproject.org/pub/epel/epel-release-latest-7.noarch.rpm<span class="token punctuation">;</span> <span class="token function">sudo</span> yum <span class="token function">install</span> -y <span class="token function">git</span> gcc bzr jq pkgconfig clang llvm mesa-libGL-devel opencl-headers ocl-icd ocl-icd-devel hwloc-devel
</code></pre></div><h3 id="编译并启动-2"><a href="#编译并启动-2" class="header-anchor">#</a> 编译并启动</h3> <div class="language-shell script extra-class"><pre class="language-shell"><code>$ <span class="token function">git</span> clone https://github.com/filecoin-project/venus.git

$ <span class="token builtin class-name">cd</span> venus

$ <span class="token function">make</span> deps

$ <span class="token function">make</span>

<span class="token comment"># 启动venus daemon 设置网络与Venus-auth的地址</span>
<span class="token comment"># 启动成功后tail -f venus.log 可以看到数据同步的log</span>
<span class="token comment"># 这里需要等待一段时间</span>
$ <span class="token function">nohup</span> ./venus daemon --network nerpa <span class="token punctuation">\</span>
--authURL http://<span class="token operator">&lt;</span>IP<span class="token operator"><span class="token file-descriptor important">1</span>&gt;</span>:8989 <span class="token punctuation">\</span>
<span class="token operator">&gt;</span> venus.log <span class="token operator"><span class="token file-descriptor important">2</span>&gt;</span><span class="token file-descriptor important">&amp;1</span> <span class="token operator">&amp;</span> 
</code></pre></div><ul><li><code>--authURL</code> 为设置Venus-auth监听http地址</li></ul> <h3 id="修改ipv4监听地址"><a href="#修改ipv4监听地址" class="header-anchor">#</a> 修改IPV4监听地址</h3> <p>目前程序启动后默认监听地址为<code>127.0.0.1:3453</code>，对于跨服务器集群，需要修改监听策略，可以通过<code>lsof -i:3453</code> 查询到进程后，Kill掉进程，修改IPV4策略后重启</p> <div class="language-shell script extra-class"><pre class="language-shell"><code><span class="token function">vim</span> ~/.venus/config.json

<span class="token comment"># 做如下操作，修改为监听所有本机IPV4地址：</span>
<span class="token comment"># replace api.apiAddress from </span>
<span class="token comment"># &quot;/ip4/127.0.0.1/tcp/3453&quot;  to  &quot;/ip4/0.0.0.0/tcp/3453&quot;</span>

<span class="token comment"># 修改完毕后重启服务：</span>
$ <span class="token function">nohup</span> ./venus daemon --network nerpa <span class="token punctuation">\</span>
--authURL http://<span class="token operator">&lt;</span>IP<span class="token operator"><span class="token file-descriptor important">1</span>&gt;</span>:8989 <span class="token punctuation">\</span>
<span class="token operator">&gt;</span> venus.log <span class="token operator"><span class="token file-descriptor important">2</span>&gt;</span><span class="token file-descriptor important">&amp;1</span> <span class="token operator">&amp;</span> <span class="token operator">&lt;</span>absolute path<span class="token operator">&gt;</span>
</code></pre></div><h2 id="_4-venus-messager-install"><a href="#_4-venus-messager-install" class="header-anchor">#</a> 4. Venus-messager install</h2> <h3 id="编译并启动-3"><a href="#编译并启动-3" class="header-anchor">#</a> 编译并启动</h3> <div class="language-shell script extra-class"><pre class="language-shell"><code>$ <span class="token function">git</span> clone https://github.com/filecoin-project/venus-messager.git

$ <span class="token builtin class-name">cd</span> venus-messager

$ <span class="token function">make</span> deps

$ <span class="token function">make</span> 

<span class="token comment"># 启动venus-message 进程</span>
$ <span class="token function">nohup</span> ./venus-messager run <span class="token punctuation">\</span>
--auth-url<span class="token operator">=</span>http://<span class="token operator">&lt;</span>IP<span class="token operator"><span class="token file-descriptor important">1</span>&gt;</span>:8989 <span class="token punctuation">\</span>
--node-url /ip4/<span class="token operator">&lt;</span>IP<span class="token operator"><span class="token file-descriptor important">3</span>&gt;</span>/tcp/3453 <span class="token punctuation">\</span>
--gateway-url /ip4/<span class="token operator">&lt;</span>IP<span class="token operator"><span class="token file-descriptor important">3</span>&gt;</span>/tcp/3453 <span class="token punctuation">\</span>
--auth-token <span class="token operator">&lt;</span>auth token<span class="token operator">&gt;</span> <span class="token punctuation">\</span>
--db-type mysql <span class="token punctuation">\</span>
--mysql-dsn <span class="token string">&quot;root:111111@tcp(127.0.0.1:3306)/cali_venus?parseTime=true&amp;loc=Local&amp;readTimeout=10s&amp;writeTimeout=10s&quot;</span> <span class="token punctuation">\</span>
<span class="token operator">&gt;</span> msg.log <span class="token operator"><span class="token file-descriptor important">2</span>&gt;</span><span class="token file-descriptor important">&amp;1</span> <span class="token operator">&amp;</span>

</code></pre></div><ul><li><code>--auth-url</code> 为设置Venus-auth监听地址</li> <li><code>--node-url</code> 为Venus监听地址</li> <li><code>--gateway-url</code> 为gateway监听地址</li> <li><code>--auth-token</code> 为在venus-auth中生成的管理员token，用于和Venus通信时的身份验证</li></ul> <h2 id="_5-venus-miner-install"><a href="#_5-venus-miner-install" class="header-anchor">#</a> 5. Venus-miner install</h2> <h3 id="编译并启动-4"><a href="#编译并启动-4" class="header-anchor">#</a> 编译并启动</h3> <div class="language-shell script extra-class"><pre class="language-shell"><code>$ <span class="token function">git</span> clone https://github.com/filecoin-project/venus-miner.git

$ <span class="token builtin class-name">cd</span> venus-miner

$ <span class="token function">make</span> nerpanet

<span class="token comment"># 初始化环境配置</span>
$ ./venus-miner init --api /ip4/<span class="token operator">&lt;</span>IP<span class="token operator"><span class="token file-descriptor important">3</span>&gt;</span>/tcp/3453 --token <span class="token operator">&lt;</span>auth token miner<span class="token operator">&gt;</span>

<span class="token comment"># 启动miner</span>
$ <span class="token function">nohup</span> ./venus-miner run <span class="token operator">&gt;&gt;</span>miner.log <span class="token operator"><span class="token file-descriptor important">2</span>&gt;&amp;</span> <span class="token number">1</span> <span class="token operator">&amp;</span>


$ ./venus-miner address <span class="token function">add</span> <span class="token punctuation">\</span>
--addr <span class="token operator">&lt;</span>t0 addr<span class="token operator">&gt;</span> <span class="token punctuation">\</span>
--sealer-listen-api /ip4/<span class="token operator">&lt;</span>IP<span class="token operator"><span class="token file-descriptor important">6</span>&gt;</span>/tcp/2345/http <span class="token punctuation">\</span>
--sealer-token <span class="token operator">&lt;</span>sealer jwt token<span class="token operator">&gt;</span> <span class="token punctuation">\</span>
--wallet-listen-api /ip4/<span class="token operator">&lt;</span>IP<span class="token operator"><span class="token file-descriptor important">2</span>&gt;</span>/tcp/5678/http <span class="token punctuation">\</span>
--wallet-token <span class="token operator">&lt;</span>wallet jwt token<span class="token operator">&gt;</span> 

<span class="token comment"># print</span>
<span class="token function">add</span> miner:  <span class="token punctuation">{</span><span class="token operator">&lt;</span>t0 addr<span class="token operator">&gt;</span> <span class="token punctuation">{</span><span class="token punctuation">..</span>.<span class="token punctuation">}</span><span class="token punctuation">}</span>


<span class="token comment"># 查询miner状态</span>
$ ./venus-miner address state 
<span class="token comment"># print</span>
<span class="token punctuation">[</span>
	<span class="token punctuation">{</span>
		<span class="token string">&quot;Addr&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;&lt;t0 addr&gt;&quot;</span>,
		<span class="token string">&quot;IsMining&quot;</span><span class="token builtin class-name">:</span> true,
		<span class="token string">&quot;Err&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;&quot;</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">]</span>

<span class="token comment"># 如果IsMining为false</span>
<span class="token comment"># 需要执行</span>
$ ./venus-miner address start <span class="token operator">&lt;</span>t0 addr<span class="token operator">&gt;</span>

<span class="token comment"># 因为miner支持多矿工</span>
<span class="token comment"># 可以通过以下指令查看所有关联矿工</span>
<span class="token comment"># 对于矿工的启停可以自行安排</span>
$ ./venus-miner address list
</code></pre></div><ul><li><code>&lt;t0 addr&gt;</code>在Venus-sealer install部分查看</li> <li><code>&lt;sealer jwt token&gt;</code>为Venus-sealer节点JWT token，切换到对应服务器后<code>cat ~/.venussealer/token</code>可获得</li> <li><code>&lt;wallet jwt token&gt;</code> 为设置Venus-wallet中获得的接口授权JWT token,查看Venus-wallet install中<code>&lt;wallet jwt token&gt;</code>处可查看token如何获得</li></ul> <h1 id="本地组件搭建"><a href="#本地组件搭建" class="header-anchor">#</a> 本地组件搭建</h1> <h2 id="准备工作"><a href="#准备工作" class="header-anchor">#</a> 准备工作</h2> <p>云上组件需要增加接入的矿工sealer和钱包生成token. 矿工只有凭借这个token才能访问云上的服务。 收钱矿工需要为自己起一个别名, 这里以jimmy为例子。在venus-auth中加入这个矿工，并为矿工生成token</p> <div class="language-shell script extra-class"><pre class="language-shell"><code>$ venus-auth addUser --name jimmy --miner f<span class="token operator"><span class="token file-descriptor important">0</span>&lt;&gt;</span>     
$ venus-auth genToken --perm <span class="token function">write</span> jimmy
<span class="token operator">&lt;</span>miner token<span class="token operator">&gt;</span>
</code></pre></div><h2 id="_1-venus-wallet-install"><a href="#_1-venus-wallet-install" class="header-anchor">#</a> 1. Venus-wallet install</h2> <h3 id="编译并启动-5"><a href="#编译并启动-5" class="header-anchor">#</a> 编译并启动</h3> <div class="language-shell script extra-class"><pre class="language-shell"><code>$ <span class="token function">git</span> clone https://github.com/filecoin-project/venus-wallet.git

$ <span class="token builtin class-name">cd</span> venus-wallet 

<span class="token comment"># 编译</span>
$ <span class="token function">make</span>

<span class="token comment"># 启动</span>
$ <span class="token function">nohup</span> ./venus-wallet run <span class="token operator">&gt;</span> wallet.log <span class="token operator"><span class="token file-descriptor important">2</span>&gt;</span><span class="token file-descriptor important">&amp;1</span> <span class="token operator">&amp;</span>
</code></pre></div><h3 id="设置密码并创建钱包"><a href="#设置密码并创建钱包" class="header-anchor">#</a> 设置密码并创建钱包</h3> <blockquote><p>此处创建了2个BLS钱包，用于之后的Venus-sealer初始化</p></blockquote> <div class="language-shell script extra-class"><pre class="language-shell"><code><span class="token comment"># 设置加解锁密码</span>
$ ./venus-wallet setpwd
Password:******
Enter Password again:******

<span class="token comment"># 生成BLS地址</span>
$ ./venus-wallet new bls
<span class="token operator">&lt;</span>bls address <span class="token operator"><span class="token file-descriptor important">1</span>&gt;</span>
$ ./venus-wallet new bls
<span class="token operator">&lt;</span>bls address <span class="token operator"><span class="token file-descriptor important">2</span>&gt;</span>
</code></pre></div><ul><li><code>&lt;bls address 1&gt;</code> 为86位长度地址</li></ul> <h4 id="注意"><a href="#注意" class="header-anchor">#</a> 注意</h4> <p>新生成的<code>&lt;bls address 1&gt;</code> <code>&lt;bls address 2&gt;</code>需要到https://faucet.nerpa.interplanetary.dev/funds.html中预充balance后才能在链上生成actor。</p> <h3 id="修改配置文件并重启"><a href="#修改配置文件并重启" class="header-anchor">#</a> 修改配置文件并重启</h3> <div class="language-toml extra-class"><pre class="language-toml"><code><span class="token comment"># Default config:</span>
<span class="token punctuation">[</span><span class="token table class-name">API</span><span class="token punctuation">]</span>
  <span class="token key property">ListenAddress</span> <span class="token punctuation">=</span> <span class="token string">&quot;/ip4/0.0.0.0/tcp/5678/http&quot;</span>

<span class="token punctuation">[</span><span class="token table class-name">DB</span><span class="token punctuation">]</span>
  <span class="token key property">Conn</span> <span class="token punctuation">=</span> <span class="token string">&quot;/root/.venus_wallet/keystore.sqlit&quot;</span>
  <span class="token key property">Type</span> <span class="token punctuation">=</span> <span class="token string">&quot;sqlite&quot;</span>
  <span class="token key property">DebugMode</span> <span class="token punctuation">=</span> <span class="token boolean">true</span>

<span class="token punctuation">[</span><span class="token table class-name">JWT</span><span class="token punctuation">]</span>
  <span class="token key property">Token</span> <span class="token punctuation">=</span> <span class="token string">&quot;65794a68624763694f694a49557a49314e694973496e523563434936496b705856434a392e65794a42624778766479493657794a795a57466b4969776964334a70644755694c434a7a615764754969776959575274615734695858302e7a534c6755446565514e6473716f666179415235445a6f4b4f48787742566855364c635636716154586663&quot;</span>
  <span class="token key property">Secret</span> <span class="token punctuation">=</span> <span class="token string">&quot;96d3bbf96ee0151a0495146bccd4825e81e12c24ed8307456a286066a610d52d&quot;</span>

<span class="token punctuation">[</span><span class="token table class-name">Factor</span><span class="token punctuation">]</span>
  <span class="token key property">ScryptN</span> <span class="token punctuation">=</span> <span class="token number">262144</span>
  <span class="token key property">ScryptP</span> <span class="token punctuation">=</span> <span class="token number">1</span>

<span class="token punctuation">[</span><span class="token table class-name">Strategy</span><span class="token punctuation">]</span>
  <span class="token key property">Level</span> <span class="token punctuation">=</span> <span class="token number">0</span>
  <span class="token key property">NodeURL</span> <span class="token punctuation">=</span> <span class="token string">&quot;&quot;</span>

<span class="token punctuation">[</span><span class="token table class-name">APIRegisterHub</span><span class="token punctuation">]</span>   //修改此处 上面勿动
<span class="token key property">RegisterAPI</span> <span class="token punctuation">=</span> <span class="token punctuation">[</span><span class="token string">&quot;/ip4/&lt;IP2&gt;/tcp/45132&quot;</span><span class="token punctuation">]</span>
<span class="token key property">Token</span> <span class="token punctuation">=</span> <span class="token string">&quot;&lt;miner token&gt;&quot;</span>
<span class="token key property">SupportAccounts</span> <span class="token punctuation">=</span> <span class="token punctuation">[</span><span class="token string">&quot;jimmy&quot;</span><span class="token punctuation">]</span>
</code></pre></div><h2 id="_2-venus-sealer-install"><a href="#_2-venus-sealer-install" class="header-anchor">#</a> 2. Venus-sealer install</h2> <h3 id="编译并启动-sealer单程序只能绑定一个矿工"><a href="#编译并启动-sealer单程序只能绑定一个矿工" class="header-anchor">#</a> 编译并启动（sealer单程序只能绑定一个矿工）</h3> <div class="language-shell script extra-class"><pre class="language-shell"><code>$ <span class="token function">git</span> clone https://github.com/filecoin-project/venus-sealer.git

$ <span class="token builtin class-name">cd</span> venus-sealer

$ <span class="token function">make</span> deps

$ <span class="token function">make</span>
</code></pre></div><h4 id="初始化新矿工-2选1"><a href="#初始化新矿工-2选1" class="header-anchor">#</a> 初始化新矿工（2选1）</h4> <div class="language-shell script extra-class"><pre class="language-shell"><code>$ <span class="token function">nohup</span> ./venus-sealer init <span class="token punctuation">\</span>
--worker <span class="token operator">&lt;</span>bls address <span class="token operator"><span class="token file-descriptor important">1</span>&gt;</span> <span class="token punctuation">\</span>
--owner <span class="token operator">&lt;</span>bls address <span class="token operator"><span class="token file-descriptor important">2</span>&gt;</span>  <span class="token punctuation">\</span>
--sector-size 512M <span class="token punctuation">\</span>
--network nerpa <span class="token punctuation">\</span>
--node-url /ip4/<span class="token operator">&lt;</span>IP<span class="token operator"><span class="token file-descriptor important">3</span>&gt;</span>/tcp/3453 <span class="token punctuation">\</span>
--messager-url /ip4/<span class="token operator">&lt;</span>IP<span class="token operator"><span class="token file-descriptor important">3</span>&gt;</span>/tcp/3453 <span class="token punctuation">\</span>
--gateway-url /ip4/<span class="token operator">&lt;</span>IP<span class="token operator"><span class="token file-descriptor important">3</span>&gt;</span>/tcp/3453 <span class="token punctuation">\</span>
--auth-token <span class="token operator">&lt;</span>auth token<span class="token operator">&gt;</span> <span class="token punctuation">\</span>
--no-local-storage <span class="token punctuation">\</span>
--wallet-name testminer <span class="token punctuation">\</span>
<span class="token operator">&gt;</span> sealer.log <span class="token operator"><span class="token file-descriptor important">2</span>&gt;</span><span class="token file-descriptor important">&amp;1</span> <span class="token operator">&amp;</span>

</code></pre></div><h4 id="初始化已存在矿工-2选1"><a href="#初始化已存在矿工-2选1" class="header-anchor">#</a> 初始化已存在矿工（2选1）</h4> <blockquote><p>不需要指定<code>--sector-size</code></p></blockquote> <div class="language-shell script extra-class"><pre class="language-shell"><code>$ ./venus-sealer init <span class="token punctuation">\</span>
--actor <span class="token operator">&lt;</span>t0 addr<span class="token operator">&gt;</span>  <span class="token punctuation">\</span>
--network nerpa <span class="token punctuation">\</span>
--node-url /ip4/<span class="token operator">&lt;</span>IP<span class="token operator"><span class="token file-descriptor important">3</span>&gt;</span>/tcp/3453 <span class="token punctuation">\</span>
--messager-url /ip4/<span class="token operator">&lt;</span>IP<span class="token operator"><span class="token file-descriptor important">3</span>&gt;</span>/tcp/3453 <span class="token punctuation">\</span>
--gateway-url /ip4/<span class="token operator">&lt;</span>IP<span class="token operator"><span class="token file-descriptor important">3</span>&gt;</span>/tcp/3453 <span class="token punctuation">\</span>
--auth-token <span class="token operator">&lt;</span>auth token<span class="token operator">&gt;</span> <span class="token punctuation">\</span>
--no-local-storage <span class="token punctuation">\</span>
--wallet-name testminer 

<span class="token comment"># 查看日志等待消息上链注册actor地址</span>
<span class="token number">2021</span>-04-25T18:41:31.925+0800	INFO	main	venus-sealer/init.go:182	Checking <span class="token keyword">if</span> repo exists
<span class="token number">2021</span>-04-25T18:41:31.926+0800	INFO	main	venus-sealer/init.go:217	Checking full node version
<span class="token number">2021</span>-04-25T18:41:31.927+0800	INFO	main	venus-sealer/init.go:233	Initializing repo
<span class="token number">2021</span>-04-25T18:41:31.928+0800	INFO	main	venus-sealer/init.go:309	Initializing libp2p identity
<span class="token number">2021</span>-04-25T18:41:32.082+0800	INFO	main	venus-sealer/init.go:485	Pushed CreateMiner message: aaf489f9-af4b-4e4b-9084-018d43f05b7e
<span class="token number">2021</span>-04-25T18:41:32.082+0800	INFO	main	venus-sealer/init.go:486	Waiting <span class="token keyword">for</span> confirmation
<span class="token number">2021</span>-04-25T18:46:32.088+0800	INFO	main	venus-sealer/init.go:502	New miners address is: t01640 <span class="token punctuation">(</span>t2cxzf7xvrqo3froqn2xgdqjdbydhkcrgakj7j3ma<span class="token punctuation">)</span>
<span class="token number">2021</span>-04-25T18:46:32.088+0800	INFO	main	venus-sealer/init.go:381	Created new miner: t01640
<span class="token number">2021</span>-04-25T18:46:32.089+0800	INFO	main	venus-sealer/init.go:302	Sealer successfully created, you can now start it with <span class="token string">'venus-sealer run'</span>

</code></pre></div><ul><li><code>&lt;bls address 1&gt;</code> <code>&lt;bls address 2&gt;</code> 为Venus-wallet中创建的BLS钱包地址，注意这2个钱包地址都需要有balance</li> <li><code>&lt;miner token&gt;</code>为Venus-auth中注册的sealer</li> <li><code>&lt;absolute path&gt;</code>为绝对路径</li></ul> <h4 id="启动sealer并执行sector封装"><a href="#启动sealer并执行sector封装" class="header-anchor">#</a> 启动sealer并执行sector封装</h4> <div class="language-shell script extra-class"><pre class="language-shell"><code>$ <span class="token function">nohup</span> ./venus-sealer run <span class="token operator">&gt;&gt;</span> sealer.log <span class="token operator"><span class="token file-descriptor important">2</span>&gt;</span><span class="token file-descriptor important">&amp;1</span> <span class="token operator">&amp;</span>

<span class="token comment"># 指定存储目录(可选)</span>
<span class="token comment"># 因为指定了--no-local-storage</span>
<span class="token comment"># 所以需要指定sealer存储目录</span>
$ ./venus-sealer storage attach --init --store --seal <span class="token operator">&lt;</span>absolute path<span class="token operator">&gt;</span>

<span class="token comment"># 执行sector封装，这个命令只支持单次</span>
<span class="token comment"># 可以通过crontab 做定时任务，也可以自行编写策略脚本执行</span>
$ ./venus-sealer sectors pledge 

<span class="token comment"># 查看sector列表</span>
$ ./venus-sealer sectors list

<span class="token comment"># 查看actor地址</span>
<span class="token comment"># 这里为&lt;t0 addr&gt;</span>
$ ./venus-sealer info

Chain: <span class="token punctuation">[</span>sync ok<span class="token punctuation">]</span> <span class="token punctuation">[</span>basefee <span class="token number">100</span> aFIL<span class="token punctuation">]</span>
Sealer: <span class="token operator">&lt;</span>t0 addr<span class="token operator">&gt;</span> <span class="token punctuation">(</span><span class="token number">512</span> MiB sectors<span class="token punctuation">)</span>
Power: <span class="token number">0</span>  / <span class="token number">15</span> Ti <span class="token punctuation">(</span><span class="token number">0.0000</span>%<span class="token punctuation">)</span>
	Raw: <span class="token number">0</span> B / <span class="token number">1.5</span> TiB <span class="token punctuation">(</span><span class="token number">0.0000</span>%<span class="token punctuation">)</span>
	Committed: <span class="token number">3</span> GiB
	Proving: <span class="token number">0</span> B
Below minimum power threshold, no blocks will be won
Sealer Balance:    <span class="token number">383.869</span> FIL
      PreCommit:  <span class="token number">0</span>
      Pledge:     <span class="token number">93.75</span> mFIL
      Vesting:    <span class="token number">0</span>
      Available:  <span class="token number">383.775</span> FIL
Market Balance:   <span class="token number">0</span>
       Locked:    <span class="token number">0</span>
       Available: <span class="token number">0</span>
Worker Balance:   <span class="token number">1000</span> FIL
Total Spendable:  <span class="token number">1383.775</span> FIL
</code></pre></div><h2 id="_7-问题相关"><a href="#_7-问题相关" class="header-anchor">#</a> 7. 问题相关</h2> <ol><li>go mod 出先如下问题</li></ol> <div class="language-shell script extra-class"><pre class="language-shell"><code>SECURITY ERROR
This download does NOT match an earlier download recorded <span class="token keyword">in</span> go.sum.
The bits may have been replaced on the origin server, or an attacker may
have intercepted the download attempt.


<span class="token comment"># 解决方案</span>
go clean -modcache
go mod tidy
</code></pre></div></div> <footer class="page-edit"><div class="edit-link"><a href="https://github.com/filecoin-project/venus-docs/edit/master/docs/zh/How-To-Deploy-MingPool.md" target="_blank" rel="noopener noreferrer">Edit this page</a> <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></div> <div class="last-updated"><span class="prefix">Last Updated:</span> <span class="time">2021/6/4 下午3:50:39</span></div></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/zh/Overview.html" class="prev">
        概述
      </a></span> <span class="next"><a href="/zh/Venus-replace-lotus.html">
        从Lotus迁移到Venus
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"><!----></div></div>
    <script src="/assets/js/app.85d61b07.js" defer></script><script src="/assets/js/2.8f9c6f4c.js" defer></script><script src="/assets/js/15.37f290d9.js" defer></script>
  </body>
</html>
