
# Simple Summary (概述)

增加一个venus-tool的工具，通过这个工具用户可以更容易的查看，设置，运行venus系统（包括链服务和本地组件等），希望通过这个工具能够带来这几方面的优化
1. 用户可以自行查看维护自己链服务上的的消息，订单数据等。
2. 可以进行链服务的设置（消息费用设置，订单ask设置等)。
3. 另外增加类似于lotus-shed的工具命令，帮助用户进行一些常规维护工作。

# Abstract (功能简介)

工具实现上倾向于实现成本地bs的网站形式， 模块上对应现有的模块分为消息模块，订单模块，算力模块，工具命令， 私钥管理， 配置模块。用户在本地运行工具。

## 配置模块
设置链服务url和token
设置market url和token
设置vsm url和token（worker信息都是通过vsm输出？）

## 工具命令
工具命令基本参考lotus-shed和miner中的命令来实现

## 消息模块
1. 在消息模块进行费用的设置
2. 在消息模块看到自己消息状态，如果消息存在问题可以自行分析消息存在的问题，然后自行进行消息替换。
   
## 订单模块
1. 在订单模块进行存储和检索ask的设置，
2. 查看订单的状态，了解自己订单的进度，自行按需要变更订单的状态

## 算力模块 （是否需要？）
1. 分矿工显示信息 ？
2. 查看worker运行的状态，目前在做哪些任务，哪些任务存在问题

## 私钥管理
1. 查看该用户下有多少注册私钥， 哪些私钥是可用的。
2. 签名审计显示当前线上发起的签名请求信息，用户可以自行进行签名审查

# Motivation (来源/背景)

由于venus分成很多个组件，其中又有线上组件和线下组件。这导致命令的实现分散，有的命令则会在多个地方反复实现，用户在使用的时候不知道该在哪里执行这些命令，也不知道这些命令是否实现。希望能够通过这个工具统一实现这些命令，补充venus目前体系中缺少的一环。

在孵化器的运行过程中，由于链服务对于客户来说是个黑盒，这会导致用户出现问题时没办法处理，比如消息出现不上链的问题，用户并没有途径去查看消息不上链的原因，也没有办法进行消息的替换，这些问题用户只能私聊管理员，让管理员帮忙进行操作。处理链路很长，花费时间很久，而且也使得管理员的工作过多。希望通过这个工具把用户对自己数据管理的能力还给他，让用户可以自己维护自己的数据，同时也减少管理员的压力。

# Specification (Spec)

## 数据隔离
在这个设计中首先需要考虑的一个问题是数据的隔离性，这是实现工具的前提。由于目前没有做数据隔离，多数重要接口都是以admin的形式授权，用户的权限无法访问这些接口，所以这里存在一个前置任务。增加用户查询获取数据的接口，并通过token中的name进行用户数据删选和检查。保证用户仅可获取到自己的数据，保证用户仅可操作自己的数据。具体的实现方式有这两种思路。

对于messager
方案1: messager中管理员接口增加Admin前缀， 用户接口正常格式，这样区分严格接口，实现过程中不容易弄混遗漏。
方案2: 在接口处理之前判断请求权限是否是admin，如果是admin则特殊处理一下。好处是接口少一些，但是不太清晰

对于market：由于market多数接口需要和lotus保持一致，倾向于增加新的接口来使用

## 保存私钥签名记录

为了保障用户的签名安全，打消用户的顾虑，增加用户签名审计的功能，用户可以自行查看链服务下发了哪些签名任务。 如果认为存在风险签名可以停止钱包接入。 但是由于目前gateway下发的签名请求并没有保存在来， 可以考虑在gateway保存一定周期内的签名请求到数据库。


## messager模块功能

1. 消息分页查询，条件过滤（消息状态）
2. 风险消息查询（错误消息， 长时间未打包的消息）
3. 消息replace
4. 设置全局和所属地址的费用（maxfee，feecap，overgaslimit, overgaspremium)

## market模块功能

1. market存储和检索ask设置
2. 存储订单分页查询，条件过滤（订单状态，piece状态）
3. 检索订单由于目前还无法关联矿工和检索地址，可以暂时搁置
4. 更新订单状态， 如果用户订单做的过程中存在问题，可以重新设置订单的状态，重新进行订单分发。

## 算力模块功能

todo!!!

## 工具命令功能

- [ ] 转帐
- [ ] 创建矿工
- [ ] 矿工体现
- [ ] 矿工设置owner
- [ ] 矿工设置control地址
- [ ] 矿工改变/确认worker矿工
- [ ] 终止扇区
- [ ] 山区续期
- [ ] 压缩扇区好
- [ ] 设置peerid
- [ ] 设置multiaddr
- [ ] 市场设置balance
- [ ] 市场提取balance
- [ ] 改变/审批受益人

其中的存在部分比较敏感的消息，这些消息可能更适合于使用本地签名进行签名，直接推送到节点上面（待定， 优先级低）

## 私钥管理

查看账号下注册了哪些地址，显示这些地址哪些是可用的。这个功能依赖账号体系的重构，目前存在不确定性质。

完成了保存签名信息的前置工作后，可以在工具中增加一个页面来查询签名记录（分页，时间条件）


# Design Rationale (设计思路)

目前情况是实现成bs网站形式，相对于命令行这种形式操作简单直观，但是可能在具体实现上会花费较多的时间。

# Backwards Compatibility (兼容性)


# Test Cases (测试用例)

# Security Considerations (安全考量)

接口请求会增加，但是在相对可控环境下问题应该不大。