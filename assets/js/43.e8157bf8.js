(window.webpackJsonp=window.webpackJsonp||[]).push([[43],{410:function(e,a,s){"use strict";s.r(a);var t=s(17),r=Object(t.a)({},(function(){var e=this,a=e.$createElement,s=e._self._c||a;return s("ContentSlotsDistributor",{attrs:{"slot-key":e.$parent.slotKey}},[s("h1",{attrs:{id:"venus-worker-task-management"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#venus-worker-task-management"}},[e._v("#")]),e._v(" venus-worker task management")]),e._v(" "),s("p",[e._v("In the previous document, we mentioned that in the venus-cluster system, the process management of the sector is placed in the worker.")]),e._v(" "),s("p",[e._v("Therefore, the management of sector tasks, especially exception handling, is also performed by the worker instance where the sector is located.")]),e._v(" "),s("p",[e._v("However, if all status viewing and exception handling need to be logged in to the corresponding machine to operate, it must be very inconvenient.")]),e._v(" "),s("p",[e._v("Therefore, in v0.2.0 and later versions, workers report status to sector-manager, and sector-manager manages workers remotely.")]),e._v(" "),s("p",[e._v("Below, we will explain how worker self-management and sector-manager manage workers separately.")]),e._v(" "),s("h2",{attrs:{id:"venus-worker-self-management"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#venus-worker-self-management"}},[e._v("#")]),e._v(" venus-worker self-management")]),e._v(" "),s("p",[e._v("The self-management of venus-worker is mainly through")]),e._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[e._v("./dist/bin/venus-worker worker\n")])])]),s("p",[e._v("A set of tools provided to call the management interface to operate, and the subcommands included are")]),e._v(" "),s("ul",[s("li",[e._v("list")]),e._v(" "),s("li",[e._v("pause")]),e._v(" "),s("li",[e._v("resume")])]),e._v(" "),s("h3",{attrs:{id:"list"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#list"}},[e._v("#")]),e._v(" list")]),e._v(" "),s("p",[s("code",[e._v("list")]),e._v(" is used to list the current state of all "),s("code",[e._v("sealing_thread")]),e._v("s in the currently running venus-worker instance. The way he uses it is")]),e._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[e._v("venus-worker worker -c "),s("span",{pre:!0,attrs:{class:"token operator"}},[e._v("<")]),e._v("config "),s("span",{pre:!0,attrs:{class:"token function"}},[e._v("file")]),e._v(" path"),s("span",{pre:!0,attrs:{class:"token operator"}},[e._v(">")]),e._v(" list\n")])])]),s("p",[e._v("Let's take the mock configuration in the codebase as an example:")]),e._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[e._v("$ ./dist/bin/venus-worker worker -c ./venus-worker/assets/venus-worker.mock.toml list\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[e._v('#0: "/home/dtynn/proj/github.com/ipfs-force-community/venus-cluster/mock-tmp/store1"; sector_id=Some(s-t010000-2), paused=true, paused_elapsed=Some (17s), state=C1Done, last_err=Some("permanent: No cached parameters found for stacked-proof-of-replication-merkletree-poseidon_hasher-8-0-0-sha256_hasher-032d3138d22506ec0082ed72b2dcba18df18477904e35bafee82b3793/cointmpail/var finding [f3793/cointmpail/var] -proof-parameters/v28-stacked-proof-of-replication-merkletree-poseidon_hasher-8-0-0-sha256_hasher-032d3138d22506ec0082ed72b2dcba18df18477904e35bafee82b3793b06832f.params]")')]),e._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[e._v('#1: "/home/dtynn/proj/github.com/ipfs-force-community/venus-cluster/mock-tmp/store2"; sector_id=Some(s-t010000-3), paused=true, paused_elapsed=Some (17s), state=C1Done, last_err=Some("permanent: No cached parameters found for stacked-proof-of-replication-merkletree-poseidon_hasher-8-0-0-sha256_hasher-032d3138d22506ec0082ed72b2dcba18df18477904e35bafee82b3793/cointmpail/var finding [f3793/cointmpail/var] -proof-parameters/v28-stacked-proof-of-replication-merkletree-poseidon_hasher-8-0-0-sha256_hasher-032d3138d22506ec0082ed72b2dcba18df18477904e35bafee82b3793b06832f.params]")')]),e._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[e._v('#2: "/home/dtynn/proj/github.com/ipfs-force-community/venus-cluster/mock-tmp/store3"; sector_id=Some(s-t010000-1), paused=true, paused_elapsed=Some (17s), state=C1Done, last_err=Some("permanent: No cached parameters found for stacked-proof-of-replication-merkletree-poseidon_hasher-8-0-0-sha256_hasher-032d3138d22506ec0082ed72b2dcba18df18477904e35bafee82b3793/cointmpail/var finding [f3793/cointmpail/var] -proof-parameters/v28-stacked-proof-of-replication-merkletree-poseidon_hasher-8-0-0-sha256_hasher-032d3138d22506ec0082ed72b2dcba18df18477904e35bafee82b3793b06832f.params]")')]),e._v("\n")])])]),s("p",[e._v("As you can see, for each "),s("code",[e._v("sealing_thread")]),e._v(" , it will list")]),e._v(" "),s("ul",[s("li",[s("p",[e._v("Serial number")])]),e._v(" "),s("li",[s("p",[e._v("Local storage location information")])]),e._v(" "),s("li",[s("p",[e._v("Sector ID (if there is a sector task being processed)")])]),e._v(" "),s("li",[s("p",[e._v("is it paused")])]),e._v(" "),s("li",[s("p",[e._v("Paused time (if there are paused sector tasks)")])]),e._v(" "),s("li",[s("p",[e._v("current status")])]),e._v(" "),s("li",[s("p",[e._v("The last exception information (if there is a sector task suspended due to exception)")])])]),e._v(" "),s("h3",{attrs:{id:"pause"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#pause"}},[e._v("#")]),e._v(" pause")]),e._v(" "),s("p",[s("code",[e._v("pause")]),e._v(" is used to pause the "),s("code",[e._v("sealing_thread")]),e._v(" for the specified sequence number. The way it is used is")]),e._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[e._v("$ venus-worker worker -c <config file path> pause --index <index>\n")])])]),s("p",[e._v("in:")]),e._v(" "),s("ul",[s("li",[s("code",[e._v("index")]),e._v(" needs to match the ordinal number in "),s("code",[e._v("list")]),e._v(".")])]),e._v(" "),s("h3",{attrs:{id:"resume"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#resume"}},[e._v("#")]),e._v(" resume")]),e._v(" "),s("p",[s("code",[e._v("resume")]),e._v(" is used to resume a suspended "),s("code",[e._v("sealing_thread")]),e._v(". The way it is used is")]),e._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[e._v("venus-worker worker -c "),s("span",{pre:!0,attrs:{class:"token operator"}},[e._v("<")]),e._v("config "),s("span",{pre:!0,attrs:{class:"token function"}},[e._v("file")]),e._v(" path"),s("span",{pre:!0,attrs:{class:"token operator"}},[e._v(">")]),e._v(" resume "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("[")]),e._v("--state "),s("span",{pre:!0,attrs:{class:"token operator"}},[e._v("<")]),e._v("state"),s("span",{pre:!0,attrs:{class:"token operator"}},[e._v(">")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("]")]),e._v(" --index "),s("span",{pre:!0,attrs:{class:"token operator"}},[e._v("<")]),e._v("index"),s("span",{pre:!0,attrs:{class:"token operator"}},[e._v(">")]),e._v("\n")])])]),s("p",[e._v("in:")]),e._v(" "),s("ul",[s("li",[s("p",[s("code",[e._v("index")]),e._v(" needs to match the ordinal number in "),s("code",[e._v("list")]),e._v(".")])]),e._v(" "),s("li",[s("p",[s("code",[e._v("state")]),e._v(" is optional.")]),e._v(" "),s("p",[e._v("If not filled, the sector will try to restart with the current state; if the correct "),s("code",[e._v("state")]),e._v(" value is filled in, it will restart with the specified state")]),e._v(" "),s("p",[e._v("For different "),s("code",[e._v("sealing_thread")]),e._v(" task types, the optional status values ​​can be found in "),s("RouterLink",{attrs:{to:"/cluster/11.Taskstatusflow.html"}},[e._v("11. Task status flow")])],1)])]),e._v(" "),s("h2",{attrs:{id:"venus-sector-manager-manages-venus-worker"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#venus-sector-manager-manages-venus-worker"}},[e._v("#")]),e._v(" venus-sector-manager manages venus-worker")]),e._v(" "),s("p",[e._v("The management of venus-worker by venus-sector-manager is mainly in two aspects:")]),e._v(" "),s("ol",[s("li",[e._v("Receive the periodic report information of the worker instance")]),e._v(" "),s("li",[e._v("Call the management interface on the specified venus-worker instance")])]),e._v(" "),s("p",[e._v("user through")]),e._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[e._v("./dist/bin/venus-sector-manager util worker\n")])])]),s("p",[e._v("Provides a set of tools to call the management interface of venus-sector-manager, or the proxy to call the management interface of the specified venus-worker to complete the operation.")]),e._v(" "),s("p",[e._v("The subcommands included are:")]),e._v(" "),s("ul",[s("li",[e._v("list")]),e._v(" "),s("li",[e._v("info")]),e._v(" "),s("li",[e._v("pause")]),e._v(" "),s("li",[e._v("resume")])]),e._v(" "),s("h3",{attrs:{id:"list-2"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#list-2"}},[e._v("#")]),e._v(" list")]),e._v(" "),s("p",[e._v("The "),s("code",[e._v("list")]),e._v(" here is used to list the worker profiles that have reported information to this venus-secotr-manager instance, for example:")]),e._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[e._v("$ ./dist/bin/venus-sector-manager util worker list\nName Dest Threads Empty Paused Errors LastPing"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),e._v("with "),s("span",{pre:!0,attrs:{class:"token operator"}},[e._v("!")]),e._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("if")]),e._v(" expired"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),e._v("\n"),s("span",{pre:!0,attrs:{class:"token number"}},[e._v("127.0")]),e._v(".0.1 "),s("span",{pre:!0,attrs:{class:"token number"}},[e._v("127.0")]),e._v(".0.1:17890 "),s("span",{pre:!0,attrs:{class:"token number"}},[e._v("3")]),e._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[e._v("0")]),e._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[e._v("3")]),e._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[e._v("3")]),e._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[e._v("2")]),e._v(".756922465s\n")])])]),s("p",[e._v("As you can see, for each instance, it will list:")]),e._v(" "),s("ul",[s("li",[e._v("instance name (if no instance name is specified, it will be the ip used to connect to venus-sector-manager)")]),e._v(" "),s("li",[e._v("instance connection information")]),e._v(" "),s("li",[s("code",[e._v("sealing_thread")]),e._v(" number")]),e._v(" "),s("li",[e._v("the number of "),s("code",[e._v("sealing_thread")]),e._v(" empty")]),e._v(" "),s("li",[e._v("The number of "),s("code",[e._v("sealing_thread")]),e._v(" suspended")]),e._v(" "),s("li",[e._v("The number of "),s("code",[e._v("sealing_thread")]),e._v(" errors reported")]),e._v(" "),s("li",[e._v("The interval from the last report to the current time")])]),e._v(" "),s("h3",{attrs:{id:"info-pause-resume"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#info-pause-resume"}},[e._v("#")]),e._v(" info / pause / resume")]),e._v(" "),s("p",[e._v("This set of commands is executed against the specified venus-worker instance.")]),e._v(" "),s("p",[e._v("Their effects are equivalent to venus-worker's own "),s("code",[e._v("list")]),e._v(" / "),s("code",[e._v("pause")]),e._v(" / "),s("code",[e._v("resume")]),e._v(", which are used in the following ways.")]),e._v(" "),s("ul",[s("li",[s("code",[e._v("venus-sector-manager util worker info <worker instance name or address>")])]),e._v(" "),s("li",[s("code",[e._v("venus-sector-manager util worker pause <worker instance name or address> <thread index>")])]),e._v(" "),s("li",[s("code",[e._v("venus-sector-manager util worker resume <worker instance name or address> <thread index> [<next state>]")])])]),e._v(" "),s("p",[e._v("Specific information can be viewed through "),s("code",[e._v("help")]),e._v(", and the definition and effect of parameters are consistent with the venus-worker management tool.")]),e._v(" "),s("p",[e._v("for example:")]),e._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[e._v("$ ./dist/bin/venus-sector-manager util worker info "),s("span",{pre:!0,attrs:{class:"token number"}},[e._v("127.0")]),e._v(".0.1\n\nIndex  Loc                                                                             SectorID     Paused  PausedElapsed  State   LastErr\n"),s("span",{pre:!0,attrs:{class:"token number"}},[e._v("0")]),e._v("      /home/dtynn/proj/github.com/ipfs-force-community/venus-cluster/mock-tmp/store1  s-t010000-2  "),s("span",{pre:!0,attrs:{class:"token boolean"}},[e._v("true")]),e._v("    13m42s         C1Done  permanent: No cached parameters found "),s("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("for")]),e._v(" stacked-proof-of-replication-merkletree-poseidon_hasher-8-0-0-sha256_hasher-032d3138d22506ec0082ed72b2dcba18df18477904e35bafee82b3793b06832f "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("[")]),e._v("failure finding /var/tmp/filecoin-proof-parameters/v28-stacked-proof-of-replication-merkletree-poseidon_hasher-8-0-0-sha256_hasher-032d3138d22506ec0082ed72b2dcba18df18477904e35bafee82b3793b06832f.params"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("]")]),e._v("\n"),s("span",{pre:!0,attrs:{class:"token number"}},[e._v("1")]),e._v("      /home/dtynn/proj/github.com/ipfs-force-community/venus-cluster/mock-tmp/store2  s-t010000-3  "),s("span",{pre:!0,attrs:{class:"token boolean"}},[e._v("true")]),e._v("    13m42s         C1Done  permanent: No cached parameters found "),s("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("for")]),e._v(" stacked-proof-of-replication-merkletree-poseidon_hasher-8-0-0-sha256_hasher-032d3138d22506ec0082ed72b2dcba18df18477904e35bafee82b3793b06832f "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("[")]),e._v("failure finding /var/tmp/filecoin-proof-parameters/v28-stacked-proof-of-replication-merkletree-poseidon_hasher-8-0-0-sha256_hasher-032d3138d22506ec0082ed72b2dcba18df18477904e35bafee82b3793b06832f.params"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("]")]),e._v("\n"),s("span",{pre:!0,attrs:{class:"token number"}},[e._v("2")]),e._v("      /home/dtynn/proj/github.com/ipfs-force-community/venus-cluster/mock-tmp/store3  s-t010000-1  "),s("span",{pre:!0,attrs:{class:"token boolean"}},[e._v("true")]),e._v("    13m42s         C1Done  permanent: No cached parameters found "),s("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("for")]),e._v(" stacked-proof-of-replication-merkletree-poseidon_hasher-8-0-0-sha256_hasher-032d3138d22506ec0082ed72b2dcba18df18477904e35bafee82b3793b06832f "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("[")]),e._v("failure finding /var/tmp/filecoin-proof-parameters/v28-stacked-proof-of-replication-merkletree-poseidon_hasher-8-0-0-sha256_hasher-032d3138d22506ec0082ed72b2dcba18df18477904e35bafee82b3793b06832f.params"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("]")]),e._v("\n")])])])])}),[],!1,null,null,null);a.default=r.exports}}]);