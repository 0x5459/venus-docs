<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Configuration example of venus-worker external executor | Venus Filecoin</title>
    <meta name="generator" content="VuePress 1.8.0">
    <link rel="icon" href="/assets/venus-logo.png">
    <script async="true" src="https://www.googletagmanager.com/gtag/js?id=G-SMSDTMGLTV"></script>
    <script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'G-SMSDTMGLTV');</script>
    <meta name="description" content="Venus is a Go implementation of the Filecoin Distributed Storage Network.">
    
    <link rel="preload" href="/assets/css/0.styles.117964e0.css" as="style"><link rel="preload" href="/assets/js/app.6c6b37e5.js" as="script"><link rel="preload" href="/assets/js/2.9fe70abb.js" as="script"><link rel="preload" href="/assets/js/40.2f22fd31.js" as="script"><link rel="prefetch" href="/assets/js/10.ec947dfe.js"><link rel="prefetch" href="/assets/js/100.44ed30cc.js"><link rel="prefetch" href="/assets/js/101.a1f9e7c4.js"><link rel="prefetch" href="/assets/js/102.9a364685.js"><link rel="prefetch" href="/assets/js/103.14a5e7a1.js"><link rel="prefetch" href="/assets/js/104.2c3e604c.js"><link rel="prefetch" href="/assets/js/105.5c46e3fd.js"><link rel="prefetch" href="/assets/js/106.f6c040d6.js"><link rel="prefetch" href="/assets/js/107.3c26a0b2.js"><link rel="prefetch" href="/assets/js/108.b5351397.js"><link rel="prefetch" href="/assets/js/109.e78b6d99.js"><link rel="prefetch" href="/assets/js/11.de33ac00.js"><link rel="prefetch" href="/assets/js/110.5c35700d.js"><link rel="prefetch" href="/assets/js/111.e49c3d38.js"><link rel="prefetch" href="/assets/js/112.13f70572.js"><link rel="prefetch" href="/assets/js/113.70025d55.js"><link rel="prefetch" href="/assets/js/114.8917b102.js"><link rel="prefetch" href="/assets/js/115.53b1bc9f.js"><link rel="prefetch" href="/assets/js/116.670283f8.js"><link rel="prefetch" href="/assets/js/117.d6f9600d.js"><link rel="prefetch" href="/assets/js/118.8724217a.js"><link rel="prefetch" href="/assets/js/119.1d37566e.js"><link rel="prefetch" href="/assets/js/12.91f5d015.js"><link rel="prefetch" href="/assets/js/120.2b09f55c.js"><link rel="prefetch" href="/assets/js/121.a00218ab.js"><link rel="prefetch" href="/assets/js/122.176dda50.js"><link rel="prefetch" href="/assets/js/123.d4101326.js"><link rel="prefetch" href="/assets/js/124.bd9f34f1.js"><link rel="prefetch" href="/assets/js/125.508c2548.js"><link rel="prefetch" href="/assets/js/126.5c08e300.js"><link rel="prefetch" href="/assets/js/127.2e8770b9.js"><link rel="prefetch" href="/assets/js/128.9f6ec6f5.js"><link rel="prefetch" href="/assets/js/129.6d928697.js"><link rel="prefetch" href="/assets/js/13.4d966ad2.js"><link rel="prefetch" href="/assets/js/130.e196a688.js"><link rel="prefetch" href="/assets/js/131.6732006c.js"><link rel="prefetch" href="/assets/js/132.4ca16cb9.js"><link rel="prefetch" href="/assets/js/133.ffd5a64e.js"><link rel="prefetch" href="/assets/js/134.edbbd81c.js"><link rel="prefetch" href="/assets/js/135.8648668e.js"><link rel="prefetch" href="/assets/js/136.772f7afd.js"><link rel="prefetch" href="/assets/js/137.5c70fa97.js"><link rel="prefetch" href="/assets/js/138.cd685511.js"><link rel="prefetch" href="/assets/js/139.caf36b6e.js"><link rel="prefetch" href="/assets/js/14.66f86f22.js"><link rel="prefetch" href="/assets/js/140.772881d3.js"><link rel="prefetch" href="/assets/js/141.c9eb599a.js"><link rel="prefetch" href="/assets/js/142.c53fad80.js"><link rel="prefetch" href="/assets/js/143.4a4c1f41.js"><link rel="prefetch" href="/assets/js/144.31c892dd.js"><link rel="prefetch" href="/assets/js/145.3118f2b7.js"><link rel="prefetch" href="/assets/js/146.83baba42.js"><link rel="prefetch" href="/assets/js/15.df845ff7.js"><link rel="prefetch" href="/assets/js/16.18866332.js"><link rel="prefetch" href="/assets/js/17.255649c7.js"><link rel="prefetch" href="/assets/js/18.b0566a78.js"><link rel="prefetch" href="/assets/js/19.404d3c6d.js"><link rel="prefetch" href="/assets/js/20.ae9d2d61.js"><link rel="prefetch" href="/assets/js/21.f103509b.js"><link rel="prefetch" href="/assets/js/22.9293c3a3.js"><link rel="prefetch" href="/assets/js/23.8a90cb50.js"><link rel="prefetch" href="/assets/js/24.c81bf4bb.js"><link rel="prefetch" href="/assets/js/25.58d2b70f.js"><link rel="prefetch" href="/assets/js/26.51729e2d.js"><link rel="prefetch" href="/assets/js/27.430fdbd3.js"><link rel="prefetch" href="/assets/js/28.2344794c.js"><link rel="prefetch" href="/assets/js/29.0c7bb433.js"><link rel="prefetch" href="/assets/js/3.14e01593.js"><link rel="prefetch" href="/assets/js/30.98cab6e1.js"><link rel="prefetch" href="/assets/js/31.df778644.js"><link rel="prefetch" href="/assets/js/32.ff7b7cea.js"><link rel="prefetch" href="/assets/js/33.05f3c8ec.js"><link rel="prefetch" href="/assets/js/34.74e2d10a.js"><link rel="prefetch" href="/assets/js/35.6acee29b.js"><link rel="prefetch" href="/assets/js/36.6895e746.js"><link rel="prefetch" href="/assets/js/37.44b927df.js"><link rel="prefetch" href="/assets/js/38.6546cf48.js"><link rel="prefetch" href="/assets/js/39.659f7472.js"><link rel="prefetch" href="/assets/js/4.cf5826a0.js"><link rel="prefetch" href="/assets/js/41.2cb9cc57.js"><link rel="prefetch" href="/assets/js/42.b4bc6854.js"><link rel="prefetch" href="/assets/js/43.e8157bf8.js"><link rel="prefetch" href="/assets/js/44.468ef2c0.js"><link rel="prefetch" href="/assets/js/45.5d9145d9.js"><link rel="prefetch" href="/assets/js/46.fc4a98b6.js"><link rel="prefetch" href="/assets/js/47.3a93aea9.js"><link rel="prefetch" href="/assets/js/48.cea8da35.js"><link rel="prefetch" href="/assets/js/49.8eaddac7.js"><link rel="prefetch" href="/assets/js/5.a0af5dba.js"><link rel="prefetch" href="/assets/js/50.9e0d04a5.js"><link rel="prefetch" href="/assets/js/51.f484f3c9.js"><link rel="prefetch" href="/assets/js/52.2d83e27e.js"><link rel="prefetch" href="/assets/js/53.367c5d0f.js"><link rel="prefetch" href="/assets/js/54.34349bc6.js"><link rel="prefetch" href="/assets/js/55.d096b05c.js"><link rel="prefetch" href="/assets/js/56.d92afcd7.js"><link rel="prefetch" href="/assets/js/57.5408d09f.js"><link rel="prefetch" href="/assets/js/58.9626f3c2.js"><link rel="prefetch" href="/assets/js/59.ee3f072b.js"><link rel="prefetch" href="/assets/js/6.95de18b2.js"><link rel="prefetch" href="/assets/js/60.cb9eb6f0.js"><link rel="prefetch" href="/assets/js/61.d6cac8c4.js"><link rel="prefetch" href="/assets/js/62.f5215ad0.js"><link rel="prefetch" href="/assets/js/63.27552992.js"><link rel="prefetch" href="/assets/js/64.90592f44.js"><link rel="prefetch" href="/assets/js/65.426b7c2f.js"><link rel="prefetch" href="/assets/js/66.43e909e3.js"><link rel="prefetch" href="/assets/js/67.d6ea0741.js"><link rel="prefetch" href="/assets/js/68.4ffdc3b6.js"><link rel="prefetch" href="/assets/js/69.c0e73ef4.js"><link rel="prefetch" href="/assets/js/7.cd0044c1.js"><link rel="prefetch" href="/assets/js/70.51a9e192.js"><link rel="prefetch" href="/assets/js/71.fe7ade02.js"><link rel="prefetch" href="/assets/js/72.830ae127.js"><link rel="prefetch" href="/assets/js/73.bd32ee3a.js"><link rel="prefetch" href="/assets/js/74.bd4817e4.js"><link rel="prefetch" href="/assets/js/75.ee0a522d.js"><link rel="prefetch" href="/assets/js/76.93619c2b.js"><link rel="prefetch" href="/assets/js/77.58b2e9d2.js"><link rel="prefetch" href="/assets/js/78.28a2933e.js"><link rel="prefetch" href="/assets/js/79.fd58a85d.js"><link rel="prefetch" href="/assets/js/8.ae71b12b.js"><link rel="prefetch" href="/assets/js/80.1de91f97.js"><link rel="prefetch" href="/assets/js/81.dccf53d7.js"><link rel="prefetch" href="/assets/js/82.1282388a.js"><link rel="prefetch" href="/assets/js/83.d55fd382.js"><link rel="prefetch" href="/assets/js/84.24b95d6b.js"><link rel="prefetch" href="/assets/js/85.3c8edcfe.js"><link rel="prefetch" href="/assets/js/86.3951acf9.js"><link rel="prefetch" href="/assets/js/87.cc3c6c1e.js"><link rel="prefetch" href="/assets/js/88.db9394dc.js"><link rel="prefetch" href="/assets/js/89.dc2b966d.js"><link rel="prefetch" href="/assets/js/9.994a6419.js"><link rel="prefetch" href="/assets/js/90.367fe0a7.js"><link rel="prefetch" href="/assets/js/91.bcc09268.js"><link rel="prefetch" href="/assets/js/92.c03e6f09.js"><link rel="prefetch" href="/assets/js/93.f0f0147d.js"><link rel="prefetch" href="/assets/js/94.e5c5edf9.js"><link rel="prefetch" href="/assets/js/95.56029c30.js"><link rel="prefetch" href="/assets/js/96.aee0899a.js"><link rel="prefetch" href="/assets/js/97.a8a80865.js"><link rel="prefetch" href="/assets/js/98.cdc6da17.js"><link rel="prefetch" href="/assets/js/99.666bac74.js">
    <link rel="stylesheet" href="/assets/css/0.styles.117964e0.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><img src="/assets/venus-logo-title.svg" alt="Venus Filecoin" class="logo"> <span class="site-name can-hide">Venus Filecoin</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/intro/" class="nav-link">
  Introduction
</a></div><div class="nav-item"><a href="/cs/" class="nav-link">
  Chain Service
</a></div><div class="nav-item"><a href="/cluster/" class="nav-link router-link-active">
  Power Service
</a></div><div class="nav-item"><a href="/market/" class="nav-link">
  Deal Service
</a></div><div class="nav-item"><a href="/modules/" class="nav-link">
  Components
</a></div><div class="nav-item"><a href="/advanced/" class="nav-link">
  Advanced
</a></div><div class="nav-item"><a href="/operation/" class="nav-link">
  Operation
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Select language" class="dropdown-title"><span class="title">Languages</span> <span class="arrow down"></span></button> <button type="button" aria-label="Select language" class="mobile-dropdown-title"><span class="title">Languages</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/cluster/processors-config-example.html" aria-current="page" class="nav-link router-link-exact-active router-link-active">
  English
</a></li><li class="dropdown-item"><!----> <a href="/zh/cluster/processors-config-example.html" class="nav-link">
  简体中文
</a></li></ul></div></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/intro/" class="nav-link">
  Introduction
</a></div><div class="nav-item"><a href="/cs/" class="nav-link">
  Chain Service
</a></div><div class="nav-item"><a href="/cluster/" class="nav-link router-link-active">
  Power Service
</a></div><div class="nav-item"><a href="/market/" class="nav-link">
  Deal Service
</a></div><div class="nav-item"><a href="/modules/" class="nav-link">
  Components
</a></div><div class="nav-item"><a href="/advanced/" class="nav-link">
  Advanced
</a></div><div class="nav-item"><a href="/operation/" class="nav-link">
  Operation
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Select language" class="dropdown-title"><span class="title">Languages</span> <span class="arrow down"></span></button> <button type="button" aria-label="Select language" class="mobile-dropdown-title"><span class="title">Languages</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/cluster/processors-config-example.html" aria-current="page" class="nav-link router-link-exact-active router-link-active">
  English
</a></li><li class="dropdown-item"><!----> <a href="/zh/cluster/processors-config-example.html" class="nav-link">
  简体中文
</a></li></ul></div></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>Introduction</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/cluster/" aria-current="page" class="sidebar-link">Overview</a></li><li><a href="/cluster/architecture.html" class="sidebar-link">Architecture</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>Deployment</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/cluster/getting-started.html" class="sidebar-link">Getting started</a></li><li><a href="/cluster/venus-sector-manager-config.html" class="sidebar-link">venus-sector-manager config</a></li><li><a href="/cluster/venus-worker-config.html" class="sidebar-link">venus-worker config</a></li><li><a href="/cluster/processors-config-example.html" aria-current="page" class="active sidebar-link">Processors config example</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/cluster/processors-config-example.html#case-analysis" class="sidebar-link">Case Analysis</a></li><li class="sidebar-sub-header"><a href="/cluster/processors-config-example.html#conclusion" class="sidebar-link">Conclusion</a></li></ul></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>Operations</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/cluster/task-flow.html" class="sidebar-link">Task flow</a></li><li><a href="/cluster/task-management.html" class="sidebar-link">Task management</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>Other Features</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/cluster/poster.html" class="sidebar-link">poster worker</a></li><li><a href="/cluster/snapdeal.html" class="sidebar-link">Snapdeal</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>Migration</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/cluster/migrate-sectors.html" class="sidebar-link">Import existing sectors</a></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="configuration-example-of-venus-worker-external-executor"><a href="#configuration-example-of-venus-worker-external-executor" class="header-anchor">#</a> Configuration example of venus-worker external executor</h1> <p>In other documents, we introduced the basic concept of <code>processor</code>, and also analyzed the configuration items of <code>processor</code> in <code>venus-worker</code>.
Next, let's take an actual scenario as an example to see how to arrange the external processor.</p> <h2 id="case-analysis"><a href="#case-analysis" class="header-anchor">#</a> Case Analysis</h2> <h3 id="hardware-configuration"><a href="#hardware-configuration" class="header-anchor">#</a> Hardware Configuration</h3> <p>The configuration we are targeting is:</p> <ul><li>Dual <code>AMD EPYC 7642 48-Core Processor</code></li> <li>2T memory</li> <li><code>GeForce RTX 3080</code> x 2</li> <li>Sufficient local NVME data disks</li></ul> <p>Thus, our available computing resources are approximately:</p> <ul><li>96 CPU physical cores at 3c/DIE, for a total of 32 usable pc1 multicore groups</li> <li>about 1.96TiB available physical memory</li> <li>2x <code>GeForce RTX 3080</code> GPUs</li></ul> <h3 id="proportioning-scheme"><a href="#proportioning-scheme" class="header-anchor">#</a> Proportioning scheme</h3> <p>Considering the encapsulation of a 32GiB CC sector, we have two possible matching schemes, which are described below.
<strong>Note</strong>: The following design can be used as a reference, but should not be used directly in the production environment.
Users need to make adjustments according to the actual situation and the output in the experimental stage.</p> <h4 id="scheme-a-28-pc1-1-pc2-1-c2-each-group-of-pc2-and-c2-has-exclusive-gpu"><a href="#scheme-a-28-pc1-1-pc2-1-c2-each-group-of-pc2-and-c2-has-exclusive-gpu" class="header-anchor">#</a> Scheme A: 28 pc1, 1 pc2, 1 c2, each group of pc2 and c2 has exclusive GPU</h4> <p>The idea of ​​this scheme is to share an independent pc2 and c2 external actuators on the premise of meeting the consumption capacity.
Its <code>processors</code> section is configured as follows:</p> <div class="language-toml extra-class"><pre class="language-toml"><code><span class="token punctuation">[</span><span class="token table class-name">processors.limitation.concurrent</span><span class="token punctuation">]</span>
<span class="token key property">pc1</span> <span class="token punctuation">=</span> <span class="token number">28</span>
<span class="token key property">pc2</span> <span class="token punctuation">=</span> <span class="token number">1</span>
<span class="token key property">c2</span> <span class="token punctuation">=</span> <span class="token number">1</span>

<span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token table class-name">processors.pc1</span><span class="token punctuation">]</span><span class="token punctuation">]</span>
<span class="token key property">numa_preferred</span> <span class="token punctuation">=</span> <span class="token number">0</span>
<span class="token key property">cgroup.cpuset</span> <span class="token punctuation">=</span> <span class="token string">&quot;0-41&quot;</span>
<span class="token key property">concurrent</span> <span class="token punctuation">=</span> <span class="token number">14</span>
<span class="token key property">envs</span> <span class="token punctuation">=</span> <span class="token punctuation">{</span> <span class="token key property">FIL_PROOFS_MAXIMIZE_CACHING</span><span class="token punctuation">=</span><span class="token string">&quot;1&quot;</span><span class="token punctuation">,</span> <span class="token key property">FIL_PROOFS_USE_MULTICORE_SDR</span> <span class="token punctuation">=</span> <span class="token string">&quot;1&quot;</span><span class="token punctuation">,</span> <span class="token key property">FIL_PROOFS_MULTICORE_SDR_PRODUCERS</span> <span class="token punctuation">=</span> <span class="token string">&quot;1&quot;</span> <span class="token punctuation">}</span>

<span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token table class-name">processors.pc1</span><span class="token punctuation">]</span><span class="token punctuation">]</span>
<span class="token key property">numa_preferred</span> <span class="token punctuation">=</span> <span class="token number">1</span>
<span class="token key property">cgroup.cpuset</span> <span class="token punctuation">=</span> <span class="token string">&quot;48-89&quot;</span>
<span class="token key property">concurrent</span> <span class="token punctuation">=</span> <span class="token number">14</span>
<span class="token key property">envs</span> <span class="token punctuation">=</span> <span class="token punctuation">{</span> <span class="token key property">FIL_PROOFS_MAXIMIZE_CACHING</span><span class="token punctuation">=</span><span class="token string">&quot;1&quot;</span><span class="token punctuation">,</span> <span class="token key property">FIL_PROOFS_USE_MULTICORE_SDR</span> <span class="token punctuation">=</span> <span class="token string">&quot;1&quot;</span><span class="token punctuation">,</span> <span class="token key property">FIL_PROOFS_MULTICORE_SDR_PRODUCERS</span> <span class="token punctuation">=</span> <span class="token string">&quot;1&quot;</span> <span class="token punctuation">}</span>

<span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token table class-name">processors.pc2</span><span class="token punctuation">]</span><span class="token punctuation">]</span>
<span class="token key property">cgroup.cpuset</span> <span class="token punctuation">=</span> <span class="token string">&quot;2,5,8,11,50,53,56,59&quot;</span>
<span class="token key property">envs</span> <span class="token punctuation">=</span> <span class="token punctuation">{</span> <span class="token key property">FIL_PROOFS_USE_GPU_COLUMN_BUILDER</span> <span class="token punctuation">=</span> <span class="token string">&quot;1&quot;</span><span class="token punctuation">,</span> <span class="token key property">FIL_PROOFS_USE_GPU_TREE_BUILDER</span> <span class="token punctuation">=</span> <span class="token string">&quot;1&quot;</span><span class="token punctuation">,</span> <span class="token key property">CUDA_VISIBLE_DEVICES</span> <span class="token punctuation">=</span> <span class="token string">&quot;0&quot;</span> <span class="token punctuation">}</span>

<span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token table class-name">processors.c2</span><span class="token punctuation">]</span><span class="token punctuation">]</span>
<span class="token key property">cgroup.cpuset</span> <span class="token punctuation">=</span> <span class="token string">&quot;14,17,20,23,26,29,32,35,42-47,62,65,68,71,74,77,80,83,90-95&quot;</span>
<span class="token key property">envs</span> <span class="token punctuation">=</span> <span class="token punctuation">{</span> <span class="token key property">CUDA_VISIBLE_DEVICES</span> <span class="token punctuation">=</span> <span class="token string">&quot;1&quot;</span> <span class="token punctuation">}</span>
</code></pre></div><p>In this configuration, a total of 2 external <code>pc1</code> executors, 1 external <code>pc2</code> executor, and 1 external <code>c2</code> executor are started:</p> <ul><li>1 <code>pc1</code> external processor, specify memory affinity to numa 0 area, use the configuration of 1 main core + 1 Producer core, allocate CPU core <code>0-41</code> located in numa 0 area;</li> <li>1 <code>pc1</code> external processor, specify memory affinity to numa 1 area, use the configuration of 1 main core + 1 Producer core, and allocate CPU cores <code>48-89</code> located in numa 1 area;</li> <li>1 <code>pc2</code> external processor, use CPU core <code>2,5,8,11,50,53,56,59</code>, specify the GPU with visible serial number 0;
The reason this approach works is that under the current <code>pc1</code> configuration, each DIE will free up a core that can be used to perform light computing tasks. In the case of <code>pc2</code> using GPU, the CPU is basically only used for data transfer;</li> <li>1 <code>c2</code> external processor, using CPU cores <code>14,17,20,23,26,29,32,35,42-47,62,65,68,71,74,77,80,83, 90-95</code>, specify the GPU with visible serial number 1;</li> <li>Spare CPU cores <code>38, 41, 86, 89</code>, which can be used for other light tasks, such as operation and maintenance management.</li></ul> <p>The advantage of this scheme is that both <code>pc2</code> and <code>c2</code> have exclusive resources, and there will be no scheduling problems.</p> <h4 id="scheme-b-28-pc1-2-pc2-2-c2-each-pc2-and-one-c2-form-a-group-each-group-occupies-1-gpu-the-tasks-of-different-stages-in-the-group-form-a-competitive-relationship"><a href="#scheme-b-28-pc1-2-pc2-2-c2-each-pc2-and-one-c2-form-a-group-each-group-occupies-1-gpu-the-tasks-of-different-stages-in-the-group-form-a-competitive-relationship" class="header-anchor">#</a> Scheme B: 28 pc1, 2 pc2, 2 c2, each pc2 and one c2 form a group, each group occupies 1 GPU, the tasks of different stages in the group form a competitive relationship</h4> <p>The idea of ​​this solution is actually to regard the dual-channel hardware configuration as a combination of two sets of single-channel hardware, and implement the same configuration strategy for each single-channel group.
Its <code>processors</code> section is configured as follows:</p> <div class="language-toml extra-class"><pre class="language-toml"><code>
<span class="token punctuation">[</span><span class="token table class-name">processors.limitation.concurrent</span><span class="token punctuation">]</span>
<span class="token key property">pc1</span> <span class="token punctuation">=</span> <span class="token number">28</span>
<span class="token key property">pc2</span> <span class="token punctuation">=</span> <span class="token number">2</span>
<span class="token key property">c2</span> <span class="token punctuation">=</span> <span class="token number">2</span>

<span class="token punctuation">[</span><span class="token table class-name">processors.ext_locks</span><span class="token punctuation">]</span>
<span class="token key property">gpu1</span> <span class="token punctuation">=</span> <span class="token number">1</span>
<span class="token key property">gpu2</span> <span class="token punctuation">=</span> <span class="token number">1</span>

<span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token table class-name">processors.pc1</span><span class="token punctuation">]</span><span class="token punctuation">]</span>
<span class="token key property">numa_preferred</span> <span class="token punctuation">=</span> <span class="token number">0</span>
<span class="token key property">cgroup.cpuset</span> <span class="token punctuation">=</span> <span class="token string">&quot;0-41&quot;</span>
<span class="token key property">concurrent</span> <span class="token punctuation">=</span> <span class="token number">14</span>
<span class="token key property">envs</span> <span class="token punctuation">=</span> <span class="token punctuation">{</span> <span class="token key property">FIL_PROOFS_MAXIMIZE_CACHING</span><span class="token punctuation">=</span><span class="token string">&quot;1&quot;</span><span class="token punctuation">,</span> <span class="token key property">FIL_PROOFS_USE_MULTICORE_SDR</span> <span class="token punctuation">=</span> <span class="token string">&quot;1&quot;</span><span class="token punctuation">,</span> <span class="token key property">FIL_PROOFS_MULTICORE_SDR_PRODUCERS</span> <span class="token punctuation">=</span> <span class="token string">&quot;1&quot;</span> <span class="token punctuation">}</span>

<span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token table class-name">processors.pc1</span><span class="token punctuation">]</span><span class="token punctuation">]</span>
<span class="token key property">numa_preferred</span> <span class="token punctuation">=</span> <span class="token number">1</span>
<span class="token key property">cgroup.cpuset</span> <span class="token punctuation">=</span> <span class="token string">&quot;48-89&quot;</span>
<span class="token key property">concurrent</span> <span class="token punctuation">=</span> <span class="token number">14</span>
<span class="token key property">envs</span> <span class="token punctuation">=</span> <span class="token punctuation">{</span> <span class="token key property">FIL_PROOFS_MAXIMIZE_CACHING</span><span class="token punctuation">=</span><span class="token string">&quot;1&quot;</span><span class="token punctuation">,</span> <span class="token key property">FIL_PROOFS_USE_MULTICORE_SDR</span> <span class="token punctuation">=</span> <span class="token string">&quot;1&quot;</span><span class="token punctuation">,</span> <span class="token key property">FIL_PROOFS_MULTICORE_SDR_PRODUCERS</span> <span class="token punctuation">=</span> <span class="token string">&quot;1&quot;</span> <span class="token punctuation">}</span>

<span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token table class-name">processors.pc2</span><span class="token punctuation">]</span><span class="token punctuation">]</span>
<span class="token key property">cgroup.cpuset</span> <span class="token punctuation">=</span> <span class="token string">&quot;2,5,8,11,14,17,20,23&quot;</span>
<span class="token key property">locks</span> <span class="token punctuation">=</span> <span class="token punctuation">[</span><span class="token string">&quot;gpu1&quot;</span><span class="token punctuation">]</span>
<span class="token key property">envs</span> <span class="token punctuation">=</span> <span class="token punctuation">{</span> <span class="token key property">FIL_PROOFS_USE_GPU_COLUMN_BUILDER</span> <span class="token punctuation">=</span> <span class="token string">&quot;1&quot;</span><span class="token punctuation">,</span> <span class="token key property">FIL_PROOFS_USE_GPU_TREE_BUILDER</span> <span class="token punctuation">=</span> <span class="token string">&quot;1&quot;</span><span class="token punctuation">,</span> <span class="token key property">CUDA_VISIBLE_DEVICES</span> <span class="token punctuation">=</span> <span class="token string">&quot;0&quot;</span> <span class="token punctuation">}</span>

<span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token table class-name">processors.pc2</span><span class="token punctuation">]</span><span class="token punctuation">]</span>
<span class="token key property">cgroup.cpuset</span> <span class="token punctuation">=</span> <span class="token string">&quot;50,53,56,59,62,65,68,71&quot;</span>
<span class="token key property">locks</span> <span class="token punctuation">=</span> <span class="token punctuation">[</span><span class="token string">&quot;gpu2&quot;</span><span class="token punctuation">]</span>
<span class="token key property">envs</span> <span class="token punctuation">=</span> <span class="token punctuation">{</span> <span class="token key property">FIL_PROOFS_USE_GPU_COLUMN_BUILDER</span> <span class="token punctuation">=</span> <span class="token string">&quot;1&quot;</span><span class="token punctuation">,</span> <span class="token key property">FIL_PROOFS_USE_GPU_TREE_BUILDER</span> <span class="token punctuation">=</span> <span class="token string">&quot;1&quot;</span><span class="token punctuation">,</span> <span class="token key property">CUDA_VISIBLE_DEVICES</span> <span class="token punctuation">=</span> <span class="token string">&quot;1&quot;</span> <span class="token punctuation">}</span>

<span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token table class-name">processors.c2</span><span class="token punctuation">]</span><span class="token punctuation">]</span>
<span class="token key property">cgroup.cpuset</span> <span class="token punctuation">=</span> <span class="token string">&quot;2,5,8,11,14,17,20,23,26,29,32,35,42-47&quot;</span>
<span class="token key property">locks</span> <span class="token punctuation">=</span> <span class="token punctuation">[</span><span class="token string">&quot;gpu1&quot;</span><span class="token punctuation">]</span>
<span class="token key property">envs</span> <span class="token punctuation">=</span> <span class="token punctuation">{</span> <span class="token key property">CUDA_VISIBLE_DEVICES</span> <span class="token punctuation">=</span> <span class="token string">&quot;0&quot;</span> <span class="token punctuation">}</span>

<span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token table class-name">processors.c2</span><span class="token punctuation">]</span><span class="token punctuation">]</span>
<span class="token key property">cgroup.cpuset</span> <span class="token punctuation">=</span> <span class="token string">&quot;50,53,56,59,62,65,68,71,74,77,80,83,90-95&quot;</span>
<span class="token key property">locks</span> <span class="token punctuation">=</span> <span class="token punctuation">[</span><span class="token string">&quot;gpu2&quot;</span><span class="token punctuation">]</span>
<span class="token key property">envs</span> <span class="token punctuation">=</span> <span class="token punctuation">{</span> <span class="token key property">CUDA_VISIBLE_DEVICES</span> <span class="token punctuation">=</span> <span class="token string">&quot;1&quot;</span> <span class="token punctuation">}</span>
</code></pre></div><p>In this configuration, a total of 2 external pc1 actuators, 2 external pc2 actuators, and 2 external c2 actuators are activated:</p> <ul><li>1 <code>pc1</code> external processor, specify memory affinity to numa 0 area, use the configuration of 1 main core + 1 Producer core, allocate CPU core <code>0-41</code> located in numa 0 area;</li> <li>1 <code>pc1</code> external processor, specify memory affinity to numa 1 area, use the configuration of 1 main core + 1 Producer core, and allocate CPU cores <code>48-89</code> located in numa 1 area;</li> <li>1 <code>pc2</code> competes with 1 <code>c2</code> around the custom control lock <code>gpu1</code> to form a group where:
<ul><li>1 <code>pc2</code>, use CPU core <code>2,5,8,11,14,17,20,23</code>, specify the GPU with visible serial number 0;</li> <li>1 <code>c2</code>, using CPU cores <code>2,5,8,11,14,17,20,23,26,29,32,35,42-47</code>, specifying the GPU whose visible serial number is 0;
The reason for this is that, limited by the custom control lock, the <code>pc2</code> and <code>c2</code> processors in this group will not perform tasks at the same time, so they can share some CPU and GPU resources;</li></ul></li> <li>1 <code>pc2</code> competes with 1 <code>c2</code> around the custom control lock <code>gpu2</code> to form a group where:
<ul><li>1 <code>pc2</code>, using CPU cores <code>50, 53, 56, 59, 62, 65, 68, 71</code>, specifying a GPU with a visible sequence number of 1;</li> <li>1 <code>c2</code>, using CPU cores <code>50,53,56,59,62,65,68,71,74,77,80,83,90-95</code>, specifying a GPU with a visible sequence number of 1;</li></ul></li> <li>Spare CPU cores <code>38, 41, 86, 89</code>, which can be used for other light tasks, such as operation and maintenance management.</li></ul> <p>Compared with scheme A, this scheme may have an extreme situation: that is, the control lock is always held by one kind of task, and the other task cannot execute the task for a long time, resulting in unsmooth sector consumption.
In layman's terms, it can be analogized as follows: the GPU is used to execute <code>pc2</code> for a long time and cannot be released to <code>c2</code>, resulting in the accumulation of sectors waiting for <code>c2</code> resources.</p> <h2 id="conclusion"><a href="#conclusion" class="header-anchor">#</a> Conclusion</h2> <p>This document provides <em>how to design a matching scheme that suits you</em>, not <em>a set of matching schemes that apply to all scenarios</em>.
In the future, we hope to provide more automatic configuration tools and calculators to simplify the process of designing solutions for users, but at the same time, it is still recommended that users have a basic understanding of the key links in the solution.</p></div> <footer class="page-edit"><div class="edit-link"><a href="https://github.com/filecoin-project/venus-docs/edit/master/docs/cluster/processors-config-example.md" target="_blank" rel="noopener noreferrer">Edit this page</a> <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></div> <div class="last-updated"><span class="prefix">Last Updated:</span> <span class="time">6/23/2022, 5:07:27 AM</span></div></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/cluster/venus-worker-config.html" class="prev">
        venus-worker config
      </a></span> <span class="next"><a href="/cluster/task-flow.html">
        Task flow
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"><!----></div></div>
    <script src="/assets/js/app.6c6b37e5.js" defer></script><script src="/assets/js/2.9fe70abb.js" defer></script><script src="/assets/js/40.2f22fd31.js" defer></script>
  </body>
</html>
